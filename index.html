<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Kaleidoscope Rainbow</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    html, body {
      margin: 0;
      overflow: hidden;
      background: black;
      touch-action: none;
      -ms-touch-action: none;
      overscroll-behavior: none;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>
<script>
  let scene = new THREE.Scene();
  let camera = new THREE.OrthographicCamera(-1, 1, 1, -1, 0, 1);
  let renderer = new THREE.WebGLRenderer();
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  let uniforms = {
    iTime: { value: 0 },
    iResolution: { value: new THREE.Vector2(window.innerWidth, window.innerHeight) },
    iMouse: { value: new THREE.Vector2(0, 0) },
    zoom: { value: 1.0 }
  };

  let lastDist = null;

  window.addEventListener('mousemove', e => {
    uniforms.iMouse.value.x = e.clientX;
    uniforms.iMouse.value.y = window.innerHeight - e.clientY;
  });

  window.addEventListener('touchstart', e => {
    if (e.touches.length === 1) {
      uniforms.iMouse.value.x = e.touches[0].clientX;
      uniforms.iMouse.value.y = window.innerHeight - e.touches[0].clientY;
    }
  }, { passive: true });

  window.addEventListener('touchmove', e => {
    if (e.touches.length === 1) {
      uniforms.iMouse.value.x = e.touches[0].clientX;
      uniforms.iMouse.value.y = window.innerHeight - e.touches[0].clientY;
    }
    if (e.touches.length === 2) {
      const dx = e.touches[0].clientX - e.touches[1].clientX;
      const dy = e.touches[0].clientY - e.touches[1].clientY;
      const dist = Math.sqrt(dx * dx + dy * dy);

      if (lastDist !== null) {
        const zoomChange = dist / lastDist;
        uniforms.zoom.value *= zoomChange;
        uniforms.zoom.value = Math.max(0.5, Math.min(3.0, uniforms.zoom.value));
      }
      lastDist = dist;
    }
  }, { passive: false });

  window.addEventListener('touchend', e => {
    if (e.touches.length < 2) {
      lastDist = null;
    }
  });

  const fragmentShader = `
    precision mediump float;
    uniform float iTime;
    uniform vec2 iResolution;
    uniform vec2 iMouse;
    uniform float zoom;

    vec3 getColor(float val) {
      float red = 0.5 + 0.5 * cos(6.2831 * val + 0.0);
      float orange = 0.5 + 0.5 * cos(6.2831 * val + 0.4);
      float yellow = 0.5 + 0.5 * cos(6.2831 * val + 0.8);
      float green = 0.5 + 0.5 * cos(6.2831 * val + 1.2);
      float cyan = 0.5 + 0.5 * cos(6.2831 * val + 1.6);
      float blue = 0.5 + 0.5 * cos(6.2831 * val + 2.0);
      float violet = 0.5 + 0.5 * cos(6.2831 * val + 2.4);
      return vec3((red + violet) / 2.0, (orange + green) / 2.0, (cyan + blue) / 2.0);
    }

    void main() {
      vec2 uv = (gl_FragCoord.xy - 0.5 * iResolution.xy) / (iResolution.y * zoom);
      vec2 mouse = (iMouse - 0.5 * iResolution.xy) / (iResolution.y * zoom);

      float r = length(uv);
      float a = atan(uv.y, uv.x);

      float symmetry = 8.0;
      a = mod(a, 6.283185 / symmetry);
      a = abs(a - 3.141592 / symmetry);
      uv = vec2(cos(a), sin(a)) * r;

      float pulse = sin(length(uv - mouse) * 10.0 - iTime);
      float colorVal = 0.5 + 0.5 * pulse;

      vec3 col = getColor(colorVal);

      gl_FragColor = vec4(col, 1.0);
    }
  `;

  let material = new THREE.ShaderMaterial({
    uniforms: uniforms,
    fragmentShader: fragmentShader
  });

  let geometry = new THREE.PlaneGeometry(2, 2);
  let mesh = new THREE.Mesh(geometry, material);
  scene.add(mesh);

  function animate(time) {
    uniforms.iTime.value = time * 0.001;
    renderer.render(scene, camera);
    requestAnimationFrame(animate);
  }
  animate();

  window.addEventListener('resize', () => {
    renderer.setSize(window.innerWidth, window.innerHeight);
    uniforms.iResolution.value.x = window.innerWidth;
    uniforms.iResolution.value.y = window.innerHeight;
  });
</script>
</body>
</html>